---
title: java之动态代理
date: 2017-11-14 11:43:51
tags:
- spring
categories:
- java基础
---

# java之动态代理



<!--more-->

什么是AOP**
​    AOP（Aspect Orient Programming），也就是面向切面编程
​    面向对象编程（OOP）是从静态角度考虑程序结构， 面向切面编程（AOP）是从动态角度考虑程序运行过程 
**AOP的作用**
​    处理一些具有横切性质的系统性服务，如事务管理、安全检查、缓存、对象池管理等
**AOP的实现原理**
​    AOP 实际上是由目标类的代理类实现的。AOP 代理其实是由AOP 框架动态生成的一个对象，该对象可为目标对象使用
​    AOP 代理包含了目标对象的全部方法，但AOP 代理中的方法与目标对象的方法存在差异，AOP 方法在特定切入点添加了增强处理，并回调了目标对象的方法
**AOP实现**
**1.静态AOP**
机制：静态织入
原理：在编译期，切面直接以字节码的形式编译到目标字节码文件中
优点：对系统无性能影响
缺点：灵活性不够
**2.动态AOP**
机制：动态代理
原理：在运行期，目标类加载后，为接口动态生成代理类，将切面植入到代理类中
优点：相对于静态AOP更加灵活
缺点：切入的关注点需要实现接口。对系统有一点性能影响
代表：JDK动态代理
接口 + InvocationHandler + 目标对象 = 代理
**3.动态字节码生成**
机制：在运行期，目标类加载后，动态构建字节码文件生成目标类的子类，将切面逻辑加入到子类中
原理：没有接口也可以织入
优点：扩展类的实例方法为final时，则无法进行织入
代表：Cglib动态代理（依赖ASM）
接口或类 + MethodInterceptor + 目标对象 = 代理
**4.自定义加载器**
机制：在运行期，目标加载前，将切面逻辑加到目标字节码里
原理：可以对绝大部分类进行织入
优点：代码中如果使用了其他类加载器，则这些类将不会被织入
代表：Javassist
**5.字节码转换**
机制：在运行期，所有类加载器加载字节码前，前进行拦截
原理：可以对所有类进行织入
代表：Javassit + Instrumentation